# 城镇技能指南
城镇是一种能够被动训练的技能，没有精通，并使用独特的时间资源反映正常的时间流逝。

城镇资源根据是否占据存储可分为两类，可占据仓储的资源一般也可兑换到城镇之外或由城镇外兑换进入城镇。

**约定：**当提及xx值时，表示的是具体的数值，当提及xx（百分比）时，指的是当前值/需求值。百分比不可超过 100%。

## 非人口相关资源
### Tick 滴
本文中将用 Tick 指代“滴”，实则为其英文表示。

Tick 是城镇系统的时间资源，它通过现实中的时间流逝获得，每 5 分钟获得 1 Tick，无论是否在线。因此可用现实中的时间系统代指 Tick，常用的计量单位如下：
* 一天/半天：288 Tick/ 144 Tick
* 每次交易（8 小时）：96 Tick
    + 等待间隔（7 小时）：84 Tick
    * 交易时间（1 小时）：12 Tick

每当重置城镇时，若剩余 Tick 小于 144，则将会在新城镇中置为 144 Tick。若多于 144 Tick 则不会改变 Tick 数。

### 土地
除每次重置随机分配到各环境的 32 个土地外，其余的 2016 块土地都需要玩家购买，并且价格根据公式逐步增长。

购买全部土地总计需要 7,464 百万 GP，最后一块土地需要 31,880 百万 GP。

每次重置城镇后，除随机分配的 32 土地外，玩家之前购买过的土地可以免费解锁。

### 信仰 Township - 主要建筑：雕像、教堂
更换信仰会随机摧毁除仓库和基础居所外 50% 的建筑，所有雕像、教堂，和使 50% 人口变为尸体。

### 存储 - 建筑：基础居所、货栈
当资源超出存储时，每 Tick 不再获得资源，但消耗的部分照常支付。

### 贸易限额 - 建筑：贸易站
贸易限额指通过贸易可以换出的物品等值 GP 数量，贸易限额可以累积，贸易会消耗贸易限额金额不得超过贸易上限。
* $每次贸易获得的贸易限额 = 500千 x 贸易站数量（最大 200）$
* 需要预先获得 10,000 物品以解锁兑换
* 药水只允许兑换 IV 级版本

#### 为召唤兑换材料
召唤在初始情况下，每次制作需要消耗的非晶体物品，其总售价总是 1,000 左右。单价低于 20 的物品，其单价会被视为 20 GP。

因此为召唤兑换材料时，可以选择单价低于 20 的物品，最好是可使用物品中最便宜的一个。这些包括：
* 普通原木
* 盖鲁姆草
* 铜矿石
* 青铜锭
* 虾

高于此售价的物品，则需要考虑获取时间-GP的比值。

## 人口/工人 - 建筑：基础居所
人口是最为基础、最为重要的城镇资源。没有它，城镇毫无用处。

人口的上限由基础居所的数量决定，但人口本身的数量则由一系列要素控制。

每个人口每 Tick 需要 30 食物。

### 人口及年龄增长
根据城镇现存人口在人口上限中的占比 A，人口每 Tick 有 B 的几率增长。增长量为人口上限的 1.5%。
* A =< 40%，B = 100%
* A =< 70%, B = 70%
* A == 100%, B = 40%

每个人口都有其年龄计数器，每 8.7 Tick 增长 1 岁，即从 0 到 100 岁需要 870 Tick，相当于 3.02 现实日：
* 人口在 8-70 岁时为工人，可以被安排到各建筑中从事生产
* 人口在 55 岁时成为老年人，开始消耗药水

#### 死亡几率 - 健康值
老年人每年有一定几率死亡并留下尸体，到达 100 岁时会立即死亡但不会留下尸体，更换信仰会导致 50% 的现存人口死亡并留下尸体。
* $死亡几率 = \frac{虚弱\times (1 + 虚弱)}{381}$
* $虚弱 = \frac{100 - 健康（百分比）}{100}$

健康需求值固定为 235，健康值来源：
* 这两项都为百分比，直接以百分值计算
    + 幸福：100
    + 教育：100
* 这三项都在库存和产量都 >0 时才有权重
    + 药水产量：15
    + 服装产量 >0 时：15
    + 草药产量 >0 时：5
* 正常情况下，健康与每 Tick 死亡几率
    + 0% 健康：0.52% 死亡几率
    + 50% 健康：0.08% 死亡几率
    + 100% 健康：0% 死亡几率

幸福 60%，教育 50%，药水、服装、草药产量都为正的情况下，百分比计算为：$\frac{60 + 50 + 15 + 15 +5}{235} = 57.4%$

当食物产出为负时，全体公民死亡几率增加 0.05%，除此以外，更换信仰，拆除木屋使人口上限下降都会导致不分年龄的死亡。

#### 死者仓储 - 主要建筑：墓地
死者仓储：每 12 Tick 消耗上限的 1%，上限只能通过建设墓地增加。
* 假设草药、药水、服装产出为正，0%幸福，100%教育时，墓地数 = 人口/360

### 幸福（经验） - 主要建筑：旅店、花园
幸福影响**经验**获取量：
* $经验量 = 0.3\times 现存人口\times (1 + 幸福)$
* $幸福需求值 = 当前人口 \times 3$

需要注意的是，教育值会等量增加幸福值。由于教育的需求值比幸福更高，因此在没有太高幸福惩罚的清空下一般不需要幸福建筑：
* 1 教育值 = 1 幸福值
* 沙漠中有建筑，服装产出为负：-50% 幸福值
* 存在 55 岁以上人口，药水产出为负：-40% 幸福值
* 没有分配岗位的工人：每个 -5
* 超出死者仓储上限的尸体：每个 -5

### 教育（产量） - 主要建筑：学校、图书馆
教育影响**产量**：
* $产量 = 基础产量\times (1 + 环境加成 + 建筑加成)\times (1 + 教育（百分比） + 其它产量加成)$
* $教育 = 当前人口\times 3$

学校和图书馆可以按照如下关系建筑：
* $学校 = \sqrt{教育需求值}$
* $图书馆 = 学校 - 100\times (1 + 教育加成)$

### 税收 - 主要建筑：市政厅
每 Tick 的税收数量取决于税率和当前人口：
* $税收 = 税率\times (当前人口 \times 0.3 + 70 岁以上人口 \times 0.3)$
* 税率在城镇系统内只受市政厅和信仰影响，最高 80%

## 其它机制
资源转化建筑的资源转化率初始为 40%，被转换的资源（如草药）不会受到任何效果影响，而转化成的资源（如药水）受所有加成影响，因此生产加成可以提高资源转化率。

生产类建筑在最高级前的版本受环境影响，到达最高级后不受任何环境影响。

## 建议
* Terran信仰 + 11图几乎是最优选
    + 死者存储 500 千以上可以考虑重开
    + 没有矿坑、伐木营地的情况可以考虑重开
    + 如果有贸易站，第二条的资源可以等贸易注入
* 果园的生产量在任何信仰和环境下都远大于其它食物建筑
* 农产市集几乎是不需要的
* 土地数量总是比数值宝贵的，比如旅店和花园之间一般会推荐旅店
* 服装可以完全不用构建，需要在沙漠建筑时通过贸易注入即可。服装的负产出对幸福的影响可以被其它建筑完全抵消
* 符文精华也可以通过贸易注入，虽然需求量更大
* 目前最赚 GP 的兑出物是用兑出物制作的辉石标枪，不过依然建议兑换自己所需的物资，如药水、食物（苹果）等

## 更多资料
许多资料 wiki 可以十分方便地查到，并且其图标的设置十分易于理解，在此列出只会付二倍功。
* [城镇](https://wiki.melvoridle.com/w/Township#Health)